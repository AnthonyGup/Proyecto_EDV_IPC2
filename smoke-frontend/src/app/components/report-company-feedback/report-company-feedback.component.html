<div class="container-fluid p-4">
  <h3 class="text-light mb-4">Reporte de Feedback</h3>
  
  <div class="row mb-3 align-items-end">
    <div class="col-md-6">
      <label class="form-label text-light">L√≠mite de Registros</label>
      <input 
        class="form-control bg-dark text-light border-secondary" 
        type="number" 
        [(ngModel)]="limit" 
        placeholder="Ej: 10"
        min="1"
      />
    </div>
    <div class="col-md-6">
      <button 
        class="btn btn-primary w-100" 
        (click)="fetch()"
        [disabled]="loading || !companyId">
        <span *ngIf="!loading">üîÑ Actualizar Reporte</span>
        <span *ngIf="loading">Cargando...</span>
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="alert alert-info">Cargando datos...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="!loading && (averageRatings.length > 0 || topComments.length > 0 || worstRated.length > 0)" class="mt-4">
    <!-- Calificaciones Promedio -->
    <div class="mb-5">
      <h5 class="text-light mb-3">Calificaciones Promedio por Juego</h5>
      <div *ngIf="averageRatings && averageRatings.length > 0" class="table-responsive">
        <table class="table table-dark table-striped">
          <thead>
            <tr>
              <th>Juego</th>
              <th>Calificaci√≥n</th>
              <th>Votantes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let game of averageRatings">
              <td>{{ game.gameTitle }}</td>
              <td>‚≠ê {{ game.averageRating | number: '1.1-1' }}/5</td>
              <td>{{ game.ratingCount }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="!averageRatings || averageRatings.length === 0" class="alert alert-warning">
        No hay calificaciones
      </div>
    </div>

    <!-- Mejores Comentarios -->
    <div class="mb-5">
      <h5 class="text-light mb-3">Mejores Comentarios</h5>
      <div *ngIf="topComments && topComments.length > 0" class="table-responsive">
        <table class="table table-dark table-striped">
          <thead>
            <tr>
              <th>Juego</th>
              <th>Usuario</th>
              <th>Comentario</th>
              <th>Respuestas</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let comment of topComments">
              <td>{{ comment.gameTitle }}</td>
              <td>{{ comment.userId }}</td>
              <td>{{ comment.commentText | slice:0:50 }}...</td>
              <td>{{ comment.replyCount }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="!topComments || topComments.length === 0" class="alert alert-warning">
        No hay comentarios
      </div>
    </div>

    <!-- Peores Calificaciones -->
    <div>
      <h5 class="text-light mb-3">Peores Calificaciones</h5>
      <div *ngIf="worstRated && worstRated.length > 0" class="table-responsive">
        <table class="table table-dark table-striped">
          <thead>
            <tr>
              <th>Juego</th>
              <th>Calificaci√≥n</th>
              <th>Votantes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let game of worstRated">
              <td>{{ game.gameTitle }}</td>
              <td>‚≠ê {{ game.averageRating | number: '1.1-1' }}/5</td>
              <td>{{ game.ratingCount }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="!worstRated || worstRated.length === 0" class="alert alert-warning">
        No hay datos
      </div>
    </div>
  </div>
</div>
